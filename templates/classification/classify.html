{% extends "base.html" %}
{% block title %}
    Klasifikasi Data - Waskita
{% endblock title %}
{% block page_title %}
    Klasifikasi Data
{% endblock page_title %}
{% block breadcrumb %}
    <li class="breadcrumb-item">
        <a href="{{ url_for("dashboard") }}">Home</a>
    </li>
    <li class="breadcrumb-item active">Klasifikasi</li>
{% endblock breadcrumb %}
{% block content %}
        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">

                <!-- Model Status -->
                <div class="row">
                    <div class="col-md-12">
                        <div class="card card-info">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-brain mr-2"></i>Status Model AI
                                </h3>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="info-box bg-gradient-info">
                                            <span class="info-box-icon"><i class="fas fa-vector-square"></i></span>
                                            <div class="info-box-content">
                                                <span class="info-box-text">Word2Vec Model</span>
                                                <span class="info-box-number">{{ 'Aktif' if word2vec_status else 'Tidak Aktif' }}</span>
                                                <div class="progress">
                                                    <div class="progress-bar bg-info"
                                                         style="width: {{ '100' if word2vec_status else '0' }}%"></div>
                                                </div>
                                                <span class="progress-description">{{ word2vec_info if word2vec_status else 'Model tidak ditemukan' }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="info-box bg-gradient-info">
                                            <span class="info-box-icon"><i class="fas fa-brain"></i></span>
                                            <div class="info-box-content">
                                                <span class="info-box-text">Naive Bayes Model 1</span>
                                                <span class="info-box-number">{{ 'Aktif' if nb1_status else 'Tidak Aktif' }}</span>
                                                <div class="progress">
                                                    <div class="progress-bar bg-info"
                                                         style="width: {{ '100' if nb1_status else '0' }}%"></div>
                                                </div>
                                                <span class="progress-description">{{ nb1_info if nb1_status else 'Model tidak ditemukan' }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="info-box bg-gradient-info">
                                            <span class="info-box-icon"><i class="fas fa-brain"></i></span>
                                            <div class="info-box-content">
                                                <span class="info-box-text">Naive Bayes Model 2</span>
                                                <span class="info-box-number">{{ 'Aktif' if nb2_status else 'Tidak Aktif' }}</span>
                                                <div class="progress">
                                                    <div class="progress-bar bg-info"
                                                         style="width: {{ '100' if nb2_status else '0' }}%"></div>
                                                </div>
                                                <span class="progress-description">{{ nb2_info if nb2_status else 'Model tidak ditemukan' }}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="info-box bg-gradient-info">
                                            <span class="info-box-icon"><i class="fas fa-brain"></i></span>
                                            <div class="info-box-content">
                                                <span class="info-box-text">Naive Bayes Model 3</span>
                                                <span class="info-box-number">{{ 'Aktif' if nb3_status else 'Tidak Aktif' }}</span>
                                                <div class="progress">
                                                    <div class="progress-bar bg-info"
                                                         style="width: {{ '100' if nb3_status else '0' }}%"></div>
                                                </div>
                                                <span class="progress-description">{{ nb3_info if nb3_status else 'Model tidak ditemukan' }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Classification Interface -->
                <div class="row">
                    <div class="col-md-8">
                        <div class="card card-primary">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-cogs mr-2"></i>Klasifikasi Data
                                </h3>
                                <div class="card-tools">
                                    <a href="{{ url_for('classification_results') }}" class="btn btn-info btn-sm">
                                        <i class="fas fa-list mr-1"></i>Lihat Hasil Klasifikasi
                                    </a>
                                </div>
                            </div>
                            <div class="card-body">
                                {% if type == 'batch' %}
                                <!-- Data Selection -->
                                <div class="form-group">
                                    <label for="dataSource">Pilih Sumber Data:</label>
                                    <select class="form-control" id="dataSource" onchange="loadDataBySource()">
                                        <option value="">-- Pilih Sumber Data --</option>
                                        <option value="clean-upload">Data Upload Bersih ({{ clean_upload_count }} data)</option>
                                        <option value="clean-scraper">Data Scraper Bersih ({{ clean_scraper_count }} data)</option>
                                    </select>
                                </div>
                                {% endif %}
                                <!-- Data Table -->
                                <div id="dataTableContainer" class="hidden">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h5 id="dataTableTitle">Data Siap Klasifikasi</h5>
                                        <div>
                                            <button class="btn btn-success" onclick="classifySelected()">
                                                <i class="fas fa-brain mr-2"></i>Klasifikasi Terpilih
                                            </button>
                                            <button class="btn btn-primary" onclick="classifyAll()">
                                                <i class="fas fa-magic mr-2"></i>Klasifikasi Semua
                                            </button>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-striped" id="classificationTable">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        <input type="checkbox" id="selectAllData">
                                                    </th>
                                                    <th>ID</th>
                                                    <th>Platform</th>
                                                    <th>Username</th>
                                                    <th>Konten Bersih</th>
                                                    <th>Status Klasifikasi</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="classificationTableBody">
                                                <!-- Data will be loaded dynamically -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <!-- Single Text Classification -->
                                <div class="mt-4">
                                    <h5>
                                        <i class="fas fa-edit mr-2"></i>Klasifikasi Teks Manual
                                    </h5>
                                    <div class="form-group">
                                        <label for="manualText">Masukkan Teks:</label>
                                        <textarea class="form-control"
                                                  id="manualText"
                                                  rows="4"
                                                  placeholder="Masukkan teks yang ingin diklasifikasi..."></textarea>
                                    </div>
                                    <button class="btn btn-info" onclick="classifyManualText()">
                                        <i class="fas fa-search mr-2"></i>Klasifikasi Teks
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Classification Results -->
                    <div class="col-md-4">
                        <div class="card card-success">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <i class="fas fa-chart-bar mr-2"></i>Hasil Klasifikasi
                                </h3>
                            </div>
                            <div class="card-body p-3">
                                <canvas id="classificationResultsChart" 
                                        class="chart-canvas-300" 
                                        role="img" 
                                        aria-label="Grafik bar menunjukkan hasil klasifikasi konten radikal dan non-radikal"
                                        aria-describedby="classification-results-description">
                                </canvas>
                                <div id="classification-results-description" class="sr-only">
                                    Grafik bar chart yang menampilkan hasil klasifikasi: Radikal dan Non-Radikal
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </section>
{% endblock content %}
{% block scripts %}
    <script>
let currentDataSource = '';
let classificationInProgress = false;
let classificationResultsChart = null;

$(document).ready(function() {
    // Initialize classification results chart
    initializeClassificationChart();
    // Initialize tooltips
    $('[data-toggle="tooltip"]').tooltip();
    
    // Select all checkbox handler
    $('#selectAllData').change(function() {
        $('#classificationTable .row-checkbox').prop('checked', this.checked);
    });
});

function initializeClassificationChart() {
    const ctx = document.getElementById('classificationResultsChart').getContext('2d');
    
    // Use actual data from backend
    const radicalCount = {{ radical_count|default(0) }};
    const nonRadicalCount = {{ non_radical_count|default(0) }};
    
    classificationResultsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Radikal', 'Non-Radikal'],
            datasets: [{
                data: [radicalCount, nonRadicalCount],
                backgroundColor: [
                    'rgba(220, 53, 69, 0.8)',
                    'rgba(40, 167, 69, 0.8)'
                ],
                borderColor: [
                    'rgba(220, 53, 69, 1)',
                    'rgba(40, 167, 69, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                title: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: false
                    }
                },
                x: {
                    title: {
                        display: false
                    }
                }
            }
        }
    });
}

function updateClassificationChart(radicalCount, nonRadicalCount) {
    if (classificationResultsChart) {
        classificationResultsChart.data.datasets[0].data = [radicalCount, nonRadicalCount];
        classificationResultsChart.update();
    }
}

function loadDataBySource() {
    const dataSource = $('#dataSource').val();
    if (!dataSource) {
        $('#dataTableContainer').hide();
        return;
    }
    
    currentDataSource = dataSource;
    
    // Show loading
    $('#dataTableContainer').show();
    $('#dataTableTitle').text('Memuat data...');
    $('#classificationTableBody').html('<tr><td colspan="7" class="text-center"><i class="fas fa-spinner fa-spin mr-2"></i>Memuat data...</td></tr>');
    
    // Simulate loading data
    setTimeout(() => {
        loadMockData(dataSource);
    }, 1000);
}

function loadMockData(dataSource) {
    const mockData = [
        {
            id: 1,
            platform: 'twitter',
            username: 'user1',
            content: 'ini adalah contoh konten yang sudah dibersihkan',
            classified: false
        },
        {
            id: 2,
            platform: 'facebook',
            username: 'user2',
            content: 'contoh konten lainnya yang siap untuk diklasifikasi',
            classified: true
        },
        {
            id: 3,
            platform: 'tiktok',
            username: 'user3',
            content: 'data bersih ketiga untuk proses klasifikasi',
            classified: false
        }
    ];
    
    let tableHtml = '';
    mockData.forEach(data => {
        const platformBadge = data.platform === 'twitter' ? 'primary' : data.platform === 'facebook' ? 'info' : 'dark';
        const statusBadge = data.classified ? 'success' : 'warning';
        const statusText = data.classified ? 'Sudah Diklasifikasi' : 'Belum Diklasifikasi';
        
        tableHtml += `
            <tr>
                <td>
                    <input type="checkbox" class="row-checkbox" value="${data.id}" ${data.classified ? 'disabled' : ''}>
                </td>
                <td>${data.id}</td>
                <td>
                    <span class="badge badge-${platformBadge}">
                        <i class="fab fa-${data.platform}"></i> ${data.platform.charAt(0).toUpperCase() + data.platform.slice(1)}
                    </span>
                </td>
                <td>${data.username}</td>
                <td>
                    <span class="content-preview" data-toggle="tooltip" title="${data.content}">
                        ${data.content.substring(0, 40)}${data.content.length > 40 ? '...' : ''}
                    </span>
                </td>
                <td>
                    <span class="badge badge-${statusBadge}">${statusText}</span>
                </td>
                <td>
                    <div class="btn-group" role="group">
                        ${!data.classified ? `
                            <button class="btn btn-sm btn-primary" onclick="classifySingle(${data.id})" title="Klasifikasi">
                                <i class="fas fa-brain"></i>
                            </button>
                        ` : `
                            <button class="btn btn-sm btn-info" onclick="viewClassificationResult(${data.id})" title="Lihat Hasil">
                                <i class="fas fa-eye"></i>
                            </button>
                        `}
                        <button class="btn btn-sm btn-secondary" onclick="viewDataDetail(${data.id})" title="Detail">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `;
    });
    
    $('#dataTableTitle').text(`Data ${dataSource === 'clean-upload' ? 'Upload' : 'Scraper'} Bersih`);
    $('#classificationTableBody').html(tableHtml);
    
    // Reinitialize tooltips
    $('[data-toggle="tooltip"]').tooltip();
}

function classifySelected() {
    const selectedIds = [];
    $('#classificationTable .row-checkbox:checked:not(:disabled)').each(function() {
        selectedIds.push($(this).val());
    });
    
    if (selectedIds.length === 0) {
        Swal.fire({
            icon: 'warning',
            title: 'Tidak Ada Data Dipilih',
            text: 'Silakan pilih data yang akan diklasifikasi'
        });
        return;
    }
    
    startClassification(selectedIds);
}

function classifyAll() {
    const allIds = [];
    $('#classificationTable .row-checkbox:not(:disabled)').each(function() {
        allIds.push($(this).val());
    });
    
    if (allIds.length === 0) {
        Swal.fire({
            icon: 'info',
            title: 'Tidak Ada Data',
            text: 'Semua data sudah diklasifikasi atau tidak ada data tersedia'
        });
        return;
    }
    
    startClassification(allIds);
}

function classifySingle(dataId) {
    startClassification([dataId]);
}

function startClassification(dataIds) {
    if (classificationInProgress) {
        Swal.fire({
            icon: 'warning',
            title: 'Klasifikasi Sedang Berjalan',
            text: 'Harap tunggu hingga proses selesai'
        });
        return;
    }
    
    Swal.fire({
        title: 'Mulai Klasifikasi?',
        text: `${dataIds.length} data akan diklasifikasi menggunakan 3 model Naive Bayes`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Ya, Mulai',
        cancelButtonText: 'Batal'
    }).then((result) => {
        if (result.isConfirmed) {
            processClassification(dataIds);
        }
    });
}

function processClassification(dataIds) {
    classificationInProgress = true;
    
    // Show progress modal
    Swal.fire({
        title: 'Memulai Klasifikasi...',
        html: `
            <div class="text-center">
                <div class="progress mb-4">
                    <div id="overallProgress" class="progress-bar progress-bar-striped progress-bar-animated" 
                         role="progressbar" style="width: 0%"></div>
                </div>
                <p id="progressText" class="mb-3">Mempersiapkan proses klasifikasi...</p>
                <div class="row">
                    <div class="col-6">
                        <div class="info-box bg-gradient-danger mb-2">
                            <span class="info-box-icon"><i class="fas fa-exclamation-triangle"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">Radikal</span>
                                <span class="info-box-number" id="modalRadical">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="info-box bg-gradient-success mb-2">
                            <span class="info-box-icon"><i class="fas fa-check-circle"></i></span>
                            <div class="info-box-content">
                                <span class="info-box-text">Non-Radikal</span>
                                <span class="info-box-number" id="modalNonRadical">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `,
        allowOutsideClick: false,
        showConfirmButton: false,
        width: 600
    });
    
    // Start actual classification process
    const csrfToken = $('meta[name=csrf-token]').attr('content');
    $.ajax({
        url: '/api/classification/start',
        method: 'POST',
        contentType: 'application/json',
        headers: {
            'X-CSRFToken': csrfToken
        },
        data: JSON.stringify({ 
            dataset_id: datasetId
        }),
        xhrFields: {
            withCredentials: true  // Kirim session cookies
        },
        success: function(response) {
            
            if (response.success) {
                // Klasifikasi berhasil dimulai, mulai polling untuk mengecek status
                const datasetId = response.dataset_id;
                checkClassificationStatus(datasetId);
            } else {
                classificationInProgress = false;
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: response.message || 'Gagal memulai proses klasifikasi'
                });
            }
        },
        error: function(xhr, status, error) {
            classificationInProgress = false;
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Terjadi kesalahan saat memulai klasifikasi: ' + error
            });
        }
    });
}

function checkClassificationStatus(datasetId) {
    // Show loading modal while checking status
    Swal.fire({
        title: 'Memeriksa Status Klasifikasi...',
        html: 'Menunggu proses klasifikasi selesai...',
        allowOutsideClick: false,
        showConfirmButton: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });
    
    // Polling untuk mengecek status dataset
    
    const checkInterval = setInterval(() => {

        $.ajax({
            url: `/api/classification/status/${datasetId}`,
            method: 'GET',
            xhrFields: {
                withCredentials: true  // Kirim session cookies
            },
            success: function(datasetResponse) {

                if (datasetResponse.success && datasetResponse.dataset) {
                    const dataset = datasetResponse.dataset;
                    
                    // Jika status dataset adalah 'Terklasifikasi', redirect ke hasil
                    if (dataset.status === 'Terklasifikasi') {

                        clearInterval(checkInterval);
                        classificationInProgress = false;
                        
                        Swal.fire({
                            icon: 'success',
                            title: 'Klasifikasi Selesai',
                            text: 'Proses klasifikasi telah berhasil diselesaikan.',
                            confirmButtonText: 'Lihat Hasil'
                        }).then(() => {
                            window.location.href = `/classification/results/${datasetId}`;
                        });
                    }
                    // Jika status masih 'Terkirim', lanjutkan polling
                    else if (dataset.status === 'Terkirim') {
                        // Lanjutkan polling
                    }
                    // Jika status error atau lainnya, tampilkan error
                    else {
                        clearInterval(checkInterval);
                        classificationInProgress = false;
                        
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: `Status dataset tidak valid: ${dataset.status}`
                        });
                    }
                }
            },
            error: function() {
                // Error saat memeriksa status, lanjutkan polling
            }
        });
    }, 3000); // Check every 3 seconds
    
    // Timeout setelah 5 menit
    setTimeout(() => {
        clearInterval(checkInterval);
        classificationInProgress = false;
        
        Swal.fire({
            icon: 'warning',
            title: 'Timeout',
            text: 'Proses klasifikasi memakan waktu terlalu lama. Silakan periksa hasil klasifikasi secara manual.'
        });
    }, 300000); // 5 minutes timeout
}


function classifyManualText() {
    const text = $('#manualText').val().trim();
    if (!text) {
        Swal.fire({
            icon: 'warning',
            title: 'Teks Kosong',
            text: 'Silakan masukkan teks yang ingin diklasifikasi'
        });
        return;
    }
    
    // Show loading
    Swal.fire({
        title: 'Mengklasifikasi Teks...',
        html: 'Memproses dengan Word2Vec dan 3 Model Naive Bayes...',
        allowOutsideClick: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });
    
    // Call API to classify text
    const csrfToken = $('meta[name=csrf-token]').attr('content');
    $.ajax({
        url: '/api/classify_manual_text',
        method: 'POST',
        contentType: 'application/json',
        headers: {
            'X-CSRFToken': csrfToken
        },
        data: JSON.stringify({ text: text }),
        success: function(response) {
            if (response.success && response.results.length >= 3) {
                const results = response.results;
                
                // Count all predictions from all three models
                const predictions = results.map(r => r.prediction);
                const radicalCount = predictions.filter(p => p === 'radikal').length;
                const nonRadicalCount = predictions.filter(p => p === 'non-radikal').length;
                
                Swal.fire({
                    title: 'Hasil Klasifikasi',
                    html: `
                        <div class="text-left">
                            <div class="mb-4 p-3 bg-light rounded">
                                <h6 class="mb-2 text-primary"><i class="fas fa-quote-left mr-2"></i>Teks yang Diklasifikasi:</h6>
                                <p class="mb-0 text-dark font-italic">"${response.text}"</p>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="text-center mb-3 text-primary"><i class="fas fa-brain mr-2"></i>Hasil Per Model</h5>
                                <div class="row g-3">
                                    <div class="col-4">
                                        <div class="card h-100 shadow-sm border-primary">
                                            <div class="card-header bg-primary text-white text-center py-2">
                                                <h6 class="mb-0 fw-bold"><i class="fas fa-cog mr-1"></i>Model 1</h6>
                                            </div>
                                            <div class="card-body text-center p-3">
                                                <span class="badge badge-${results[0].prediction === 'radikal' ? 'danger' : 'success'} badge-lg fs-6 mb-2 px-3 py-2">
                                                    ${results[0].prediction.toUpperCase()}
                                                </span>
                                                <div class="mt-3">
                                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                                        <small class="text-danger fw-bold">Radikal:</small>
                                                        <strong class="text-danger">${(results[0].probability_radikal * 100).toFixed(1)}%</strong>
                                                    </div>
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <small class="text-success fw-bold">Non-Radikal:</small>
                                                        <strong class="text-success">${(results[0].probability_non_radikal * 100).toFixed(1)}%</strong>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="card h-100 shadow-sm border-info">
                                            <div class="card-header bg-info text-white text-center py-2">
                                                <h6 class="mb-0 fw-bold"><i class="fas fa-cog mr-1"></i>Model 2</h6>
                                            </div>
                                            <div class="card-body text-center p-3">
                                                <span class="badge badge-${results[1].prediction === 'radikal' ? 'danger' : 'success'} badge-lg fs-6 mb-2 px-3 py-2">
                                                    ${results[1].prediction.toUpperCase()}
                                                </span>
                                                <div class="mt-3">
                                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                                        <small class="text-danger fw-bold">Radikal:</small>
                                                        <strong class="text-danger">${(results[1].probability_radikal * 100).toFixed(1)}%</strong>
                                                    </div>
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <small class="text-success fw-bold">Non-Radikal:</small>
                                                        <strong class="text-success">${(results[1].probability_non_radikal * 100).toFixed(1)}%</strong>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="card h-100 shadow-sm border-warning">
                                            <div class="card-header bg-warning text-dark text-center py-2">
                                                <h6 class="mb-0 fw-bold"><i class="fas fa-cog mr-1"></i>Model 3</h6>
                                            </div>
                                            <div class="card-body text-center p-3">
                                                <span class="badge badge-${results[2].prediction === 'radikal' ? 'danger' : 'success'} badge-lg fs-6 mb-2 px-3 py-2">
                                                    ${results[2].prediction.toUpperCase()}
                                                </span>
                                                <div class="mt-3">
                                                    <div class="d-flex justify-content-between align-items-center mb-1">
                                                        <small class="text-danger fw-bold">Radikal:</small>
                                                        <strong class="text-danger">${(results[2].probability_radikal * 100).toFixed(1)}%</strong>
                                                    </div>
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <small class="text-success fw-bold">Non-Radikal:</small>
                                                        <strong class="text-success">${(results[2].probability_non_radikal * 100).toFixed(1)}%</strong>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-center p-4 bg-light rounded">
                                <h5 class="mb-3 text-primary"><i class="fas fa-chart-pie mr-2"></i>Hasil Klasifikasi Keseluruhan</h5>
                                <div class="row justify-content-center">
                                    <div class="col-auto mb-2">
                                        <span class="badge bg-danger fs-5 px-4 py-2 rounded-pill">
                                            <i class="fas fa-exclamation-triangle mr-2"></i>Radikal: ${radicalCount}
                                        </span>
                                    </div>
                                    <div class="col-auto mb-2">
                                        <span class="badge bg-success fs-5 px-4 py-2 rounded-pill">
                                            <i class="fas fa-check-circle mr-2"></i>Non-Radikal: ${nonRadicalCount}
                                        </span>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="badge bg-primary fs-6 px-3 py-1">
                                        Total: ${radicalCount + nonRadicalCount} prediksi dari 3 model
                                    </span>
                                </div>
                                <p class="text-muted mt-3 mb-0 small">
                                    <i class="fas fa-info-circle mr-1"></i>Setiap teks diklasifikasi oleh 3 model Naive Bayes
                                </p>
                            </div>
                        </div>
                    `,
                    width: 1000,
                    showCloseButton: true,
                    showConfirmButton: false,
                    customClass: {
                        popup: 'rounded-4 swal2-popup-xwide'
                    }
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: response.message || 'Tidak dapat mengklasifikasi teks'
                });
            }
        },
        error: function(xhr, status, error) {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Terjadi kesalahan saat mengklasifikasi teks'
            });
        },
        complete: function() {
            $('#manualText').val('');
        }
    });
}

function viewClassificationResult(dataId) {
    // Mock classification result
    Swal.fire({
        title: 'Hasil Klasifikasi',
        html: `
            <div class="text-left">
                <p><strong>ID Data:</strong> ${dataId}</p>
                <p><strong>Konten:</strong> "Ini adalah contoh konten yang sudah diklasifikasi"</p>
                <hr>
                <div class="row">
                    <div class="col-4 text-center">
                        <h6>Model 1</h6>
                        <span class="badge bg-success badge-lg">NON-RADIKAL</span>
                    </div>
                    <div class="col-4 text-center">
                        <h6>Model 2</h6>
                        <span class="badge badge-success badge-lg">NON-RADIKAL</span>
                    </div>
                    <div class="col-4 text-center">
                        <h6>Model 3</h6>
                        <span class="badge bg-danger badge-lg">RADIKAL</span>
                    </div>
                </div>
                <hr>
                <div class="text-center">
                    <h5>Prediksi Final:</h5>
                    <span class="badge bg-success" style="font-size: 1.2em; padding: 10px 20px;">NON-RADIKAL</span>
                </div>
            </div>
        `,
        width: 600,
        showCloseButton: true,
        showConfirmButton: false
    });
}

function viewDataDetail(dataId) {
    Swal.fire({
        title: 'Detail Data',
        html: `
            <div class="text-left">
                <p><strong>ID:</strong> ${dataId}</p>
                <p><strong>Platform:</strong> Twitter</p>
                <p><strong>Username:</strong> user_example</p>
                <p><strong>Konten Asli:</strong> "Ini adalah contoh konten asli dengan emoji ðŸ˜€"</p>
                <p><strong>Konten Bersih:</strong> "ini adalah contoh konten asli dengan emoji"</p>
                <p><strong>Tanggal:</strong> 2024-01-15 10:30:00</p>
            </div>
        `,
        width: 600,
        showCloseButton: true,
        showConfirmButton: false
    });
}
    </script>
    <style>
.info-box {
    margin-bottom: 15px;
}

.progress-group {
    margin-bottom: 15px;
}

.content-preview {
    cursor: help;
}

.badge-lg {
    font-size: 0.9em;
    padding: 8px 12px;
}

.card-body .row .card {
    margin-bottom: 10px;
}

.list-group-item {
    border-left: none;
    border-right: none;
}

.list-group-item:first-child {
    border-top: none;
}

.list-group-item:last-child {
    border-bottom: none;
}

.progress-bar-animated {
    animation: progress-bar-stripes 1s linear infinite;
}

@keyframes progress-bar-stripes {
    0% {
        background-position: 1rem 0;
    }
    100% {
        background-position: 0 0;
    }
}
    </style>
{% endblock scripts %}
