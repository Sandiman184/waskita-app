<div class="modal-header">
    <h5 class="modal-title">Dataset Details: {{ dataset.name }}</h5>
    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
    <span aria-hidden="true">Ã—</span>
</button>
</div>
<div class="modal-body">
    <div class="row">
        <div class="col-md-6">
            <h6>Dataset Information</h6>
            <table class="table table-sm">
                <tr>
                    <td><strong>Dataset Name:</strong></td>
                    <td>{{ dataset.name }}</td>
                </tr>
                <tr>
                    <td><strong>Created by:</strong></td>
                    <td>{{ dataset.user.username if dataset.user else 'Unknown' }}</td>
                </tr>
                <tr>
                    <td><strong>Created Date:</strong></td>
                    <td>{{ dataset.created_at|format_datetime('datetime') if dataset.created_at else '-' }}</td>
                </tr>
                <tr>
                    <th>Last Updated</th>
                    <td>{{ dataset.updated_at|format_datetime('datetime') if dataset.updated_at else '-' }}</td>
                </tr>
                <tr>
                    <td><strong>Total Records:</strong></td>
                    <td>{{ dataset.total_records }}</td>
                </tr>
            </table>
        </div>
        <div class="col-md-6">
            <h6>Data Statistics</h6>
            <div class="row">
                <div class="col-6">
                    <div class="card bg-primary text-white mb-2">
                        <div class="card-body p-2 text-center">
                            <h5 class="mb-0">{{ (raw_upload_data|length) + (raw_scraper_data|length) }}</h5>
                            <small>Raw Data</small>
                            <div class="mt-1">
                                <small class="d-block">Upload: {{ raw_upload_data|length }}</small>
                                <small class="d-block">Scraper: {{ raw_scraper_data|length }}</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="card bg-success text-white mb-2">
                        <div class="card-body p-2 text-center">
                            <h5 class="mb-0">{{ (clean_upload_data|length) + (clean_scraper_data|length) }}</h5>
                            <small>Clean Data</small>
                            <div class="mt-1">
                                <small class="d-block">Upload: {{ clean_upload_data|length }}</small>
                                <small class="d-block">Scraper: {{ clean_scraper_data|length }}</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="card bg-info text-white mb-2">
                        <div class="card-body p-2 text-center">
                            <h5 class="mb-0">{{ (classified_upload_data|length) + (classified_scraper_data|length) }}</h5>
                            <small>Classified</small>
                            <div class="mt-1">
                                <small class="d-block">Upload: {{ classified_upload_data|length }}</small>
                                <small class="d-block">Scraper: {{ classified_scraper_data|length }}</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="card bg-warning text-white mb-2">
                        <div class="card-body p-2 text-center">
                            <h5 class="mb-0">{{ ((raw_upload_data|length) + (raw_scraper_data|length)) - ((clean_upload_data|length) + (clean_scraper_data|length)) }}</h5>
                            <small>Needs Cleaning</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <hr>
    
    <!-- Data Preview -->
    <div class="row">
        <div class="col-12">
            <h6>Data Preview</h6>
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" id="dataPreviewTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="raw-data-tab" data-toggle="tab" data-target="#raw-data" type="button" role="tab" aria-controls="raw-data" aria-selected="true">
                        Raw Data ({{ (raw_upload_data|length) + (raw_scraper_data|length) }})
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="clean-data-tab" data-toggle="tab" data-target="#clean-data" type="button" role="tab" aria-controls="clean-data" aria-selected="false">
                        Clean Data ({{ (clean_upload_data|length) + (clean_scraper_data|length) }})
                    </button>
                </li>
            </ul>
            
            <!-- Tab panes -->
            <div class="tab-content" id="dataPreviewTabContent">
                <!-- Raw Data Tab -->
                <div class="tab-pane fade show active" id="raw-data" role="tabpanel" aria-labelledby="raw-data-tab">
                    <div class="table-responsive mt-3">
                        <table class="table table-sm table-striped">
                            <thead>
                                <tr>
                                    <th>Platform</th>
                                    <th>Username & URL</th>
                                    <th>Content</th>
                                    <th>Status</th>
                                    <th>Source</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% set all_raw_data = [] %}
                                {% for data in raw_upload_data %}
                                    {% set _ = all_raw_data.append({'data': data, 'source': 'upload'}) %}
                                {% endfor %}
                                {% for data in raw_scraper_data %}
                                    {% set _ = all_raw_data.append({'data': data, 'source': 'scraper'}) %}
                                {% endfor %}
                                
                                {% for item in all_raw_data %}
                                <tr>
                                    <td>{{ item.data.platform }}</td>
                                    <td>
                                        <strong>{{ item.data.username }}</strong>
                                        {% if item.data.url %}
                                            <br><small class="text-muted">{{ item.data.url[:50] }}{% if item.data.url|length > 50 %}...{% endif %}</small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="content-preview">
                                            {{ item.data.content[:100] }}{% if item.data.content|length > 100 %}...{% endif %}
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-gradient-secondary">{{ t('Raw') }}</span>
                                    </td>
                                    <td>
                                        {% if item.source == 'upload' %}
                                            <span class="badge bg-info">{{ t('Upload') }}</span>
                                        {% else %}
                                            <span class="badge bg-secondary">{{ t('Scraping') }}</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                                {% if all_raw_data|length == 0 %}
                                <tr>
                                    <td colspan="5" class="text-center text-muted">No raw data</td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Clean Data Tab -->
                <div class="tab-pane fade" id="clean-data" role="tabpanel" aria-labelledby="clean-data-tab">
                    <div class="table-responsive mt-3">
                        <table class="table table-sm table-striped">
                            <thead>
                                <tr>
                                    <th>Platform</th>
                                    <th>Username & URL</th>
                                    <th>Original Content</th>
                                    <th>Clean Content</th>
                                    <th>Source</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% set all_clean_data = [] %}
                                {% for data in clean_upload_data %}
                                    {% set _ = all_clean_data.append({'data': data, 'source': 'upload'}) %}
                                {% endfor %}
                                {% for data in clean_scraper_data %}
                                    {% set _ = all_clean_data.append({'data': data, 'source': 'scraper'}) %}
                                {% endfor %}
                                
                                {% for item in all_clean_data %}
                                <tr>
                                    <td>{{ item.data.platform }}</td>
                                    <td>
                                        <strong>{{ item.data.username }}</strong>
                                        {% if item.data.url %}
                                            <br><small class="text-muted">{{ item.data.url[:50] }}{% if item.data.url|length > 50 %}...{% endif %}</small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="content-preview">
                                            {{ item.data.content[:80] }}{% if item.data.content|length > 80 %}...{% endif %}
                                        </div>
                                    </td>
                                    <td>
                                        <div class="content-preview">
                                            {{ item.data.cleaned_content[:80] }}{% if item.data.cleaned_content|length > 80 %}...{% endif %}
                                        </div>
                                    </td>
                                    <td>
                                        {% if item.source == 'upload' %}
                                            <span class="badge bg-info">Upload</span>
                                        {% else %}
                                            <span class="badge bg-secondary">Scraping</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                                {% if all_clean_data|length == 0 %}
                                <tr>
                                    <td colspan="5" class="text-center text-muted">No clean data</td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
</div>